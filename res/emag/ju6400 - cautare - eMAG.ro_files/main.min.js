if("undefined"===$.type(Emag))var Emag={};"undefined"===$.type(Emag.Search)&&(Emag.Search={});var typeahead_flag=!1,assets_version="0";!function(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src;if(-1!==t.indexOf("?v=")){var i=t.match(/\?v=([\w\.]*)&?/);i&&(assets_version=i[1])}}(),Emag.Search={_config:{search_url_prefix:""},init:function(){var e=this;"undefined"!=$.type(search_url_prefix)&&(this._config.search_url_prefix=search_url_prefix),$(function(t){t("#emg-category-menu-icon").bind("click",function(){t("#search-global").submit()}),t("#search-global").bind("submit",function(i){if(typeahead_flag)return!1;t("#emg-input-autosuggest").val()==t("#emg-input-autosuggest").attr("placeholder")&&t("#emg-input-autosuggest").val("");var s=t("#emg-input-autosuggest").val().trim();return s.length<=1?!1:void e.search()})})},search:function(){var e=this._stripCharacters($("#emg-input-autosuggest").val());if(0==e.length)e="listall";else if(1==e.length)return!1;var t=$("#emg-input-autosuggest").attr("data-c");"supermarket"==t?this._config.search_url_prefix="/supermarket":"info"==t?this._config.search_url_prefix="/info":this._config.search_url_prefix="",window.location=this._config.search_url_prefix+"/search/"+encodeURIComponent(e)},_stripCharacters:function(e){return e=e.replace(/%/g," "),e=e.replace(/\//g," "),e=e.replace(/\\/g," "),e=$.trim(e)}},"undefined"===$.type(Emag.Search.Suggest)&&(Emag.Search.Suggest={}),"undefined"===$.type(Emag.Search.Suggest.Config)&&(Emag.Search.Suggest.Config={}),Emag.Search.Suggest.Exceptions={NoConfigException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"The instance config is missing.",this.htmlMessage="undefined"!=$.type(e)?e:"The instance config is missing.",this.toString=function(){return this.name+": "+this.message},this},InvalidEngineException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"The instance engine is invalid.",this.htmlMessage="undefined"!=$.type(e)?e:"The instance engine is invalid.",this.toString=function(){return this.name+": "+this.message},this},NoPreloadSectionException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"The preload section was not specified.",this.htmlMessage="undefined"!=$.type(e)?e:"The preload section was not specified.",this.toString=function(){return this.name+": "+this.message},this},NoEngineException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"The instance engine was not specified.",this.htmlMessage="undefined"!=$.type(e)?e:"The instance engine was not specified.",this.toString=function(){return this.name+": "+this.message},this},InvalidLocaleException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"The instance locale is invalid.",this.htmlMessage="undefined"!=$.type(e)?e:"The instance locale is invalid.",this.toString=function(){return this.name+": "+this.message},this},NoLocaleException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"The instance locale was not specified.",this.htmlMessage="undefined"!=$.type(e)?e:"The instance locale was not specified.",this.toString=function(){return this.name+": "+this.message},this},AjaxException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"An error occured while loading file.",this.htmlMessage="undefined"!=$.type(e)?e:"An error occured while loading file.",this.toString=function(){return this.name+": "+this.message},this}},Emag.Search.Suggest.Box={_instance:null,_cookies:{},_engine:"solr",_defaultEngine:"solr",_allowedEngines:["solr"],instanceName:"Emag.Search.Suggest.Box._instance",visitorId:null,sessionId:null,_locale:null,_defaultLocale:"ro",_allowedLocales:["ro","en","bg","hu"],_translations:translation_config,_config:{parameters:{formName:"search-global",queryParamName:"emg-input-autosuggest",divLayerName:"suggestLayer",divLoaderName:"suggestLoader"}},debug:!1,_abOption:null,setABOption:function(e){this._abOption=e},getABOption:function(){return this._abOption},getLocale:function(){return this._locale},setLocale:function(e){this._locale=e.toLowerCase()},getEngine:function(){return this._engine},setEngine:function(e){this._engine=e.toLowerCase()},_processCookies:function(){var e="Emag.Search.Suggest.Box._cookies";try{this._cookies=null!=$.parseJSON($.cookie(e))?$.parseJSON($.cookie(e)):{}}catch(t){}"undefined"!=$.type(this._cookies.debug)&&(this.debug="true"==this._cookies.debug),"undefined"!=$.type(this._cookies.locale)&&(this._locale=this._cookies.locale.toLowerCase()),"undefined"!=$.type(this._cookies.engine)&&(this._engine=this._cookies.engine.toLowerCase()),this.debug===!0&&console.debug("_processCookies")},setup:function(e){var t=this,e=e||{};e.locale=e.locale||this._defaultLocale,e.engine=e.engine||this._defaultEngine;try{if(null==e.locale)throw Emag.Search.Suggest.Exceptions.NoLocaleException();if(!$.inArray(this._allowedLocales,e.locale))throw Emag.Search.Suggest.Exceptions.InvalidLocaleException();this._locale=e.locale.toLowerCase()}catch(i){console.error(i.message)}try{if(null==e.engine)throw Emag.Search.Suggest.Exceptions.NoEngineException();if(!$.inArray(this._allowedEngines,e.engine))throw Emag.Search.Suggest.Exceptions.InvalidEngineException();this._engine=e.engine.toLowerCase()}catch(i){console.error(i.message)}this._processCookies(),t._loadWorkflow()},_loadWorkflow:function(){var e=this;switch(this.debug===!0&&console.debug("_loadWorkflow"),this._engine){case"solr":$.extend(!0,Emag.Search.Suggest.Config,e._config),$.when(e._loadEngine()).done(function(t){e._instance=t,$.when(e._ping()).done(function(){$.when(e._init()).always(function(){e._exit()})})})}},_loadEngine:function(){this.debug===!0&&console.debug("_loadEngine");var e=$.Deferred();try{switch(this._engine){case"solr":$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","/js/emag/search/suggest/skins/solr/theme.css?v="+assets_version),$.ajax({url:"/js/emag/search/suggest/engines/solr.js?v="+assets_version,type:"GET",dataType:"script",cache:!0}).done(function(){e.resolve(new SolrSuggest($))}).fail(function(t,i,s){throw e.reject(),Emag.Search.Suggest.Exceptions.AjaxException(s)});break;default:throw Emag.Search.Suggest.Exceptions.InvalidEngineException()}}catch(t){console.error(t.message)}return e.promise()},_init:function(){this.debug===!0&&console.debug("_init");try{switch(this._engine){case"solr":this._solr();break;default:throw Emag.Search.Suggest.Exceptions.InvalidEngineException()}}catch(e){console.error(e.message)}},_ping:function(){return this.debug===!0&&console.debug("_ping"),this._instance.config(this._config),this._instance.ping()},_solr:function(){this.debug===!0&&console.debug("_solr"),$('<div id="suggestLoader" class="emg-autosuggest-loader"></div>').appendTo($("#emg-search-suggest")),$('<div id="suggestLayer" class="emg-fluid-autosuggest"></div>').insertAfter($("#emg-search-suggest"));try{"undefined"!=$.type(search_url_prefix)&&(this._config.search_url_prefix=search_url_prefix),this._config.debug=this.debug;var e=this._config.parameters.formName,t=this._config.parameters.queryParamName,i=this._config.parameters.divLayerName,s=this._config.parameters.divLoaderName;this._instance.config(this._config),this._instance.init(e,t,i,s,this._translations)}catch(n){console.log(n.message)}},_exit:function(){this.debug===!0&&(console.debug("_exit"),console.debug(this))}},"undefined"===$.type(Emag.Search.Debug)&&(Emag.Search.Debug={}),Emag.Search.Debug.Tool={init:function(){$(".product-holder-grid, figure.emg-listing-products").each(function(){if($(this).css("position","relative"),$(this).attr("data-id")){var e=$(this).attr("data-id");$("<div class='debug-overlay'></div>").appendTo($(this));var t=debugProducts[e].debug,i=debugProducts[e].image,s=debugProducts[e].name,n=debugProducts[e].link;$(".debug-overlay",this).html('<div style="position: relative;"><div class="debug-product-name"><img src="'+i+'" style="width: 25px; float: left; margin-right: 5px; border: 1px solid #ccc;"><a href="'+n+'" target="_blank">'+s+"</a></div>");for(var o in t)o&&t[o]&&(data=o.split(":"),$(".debug-overlay",this).append('<div style="margin-top: 3px;"><b>'+data[0]+("undefined"!=typeof data[1]?"</b><br>"+data[1]:"")+("boost_functions()"==data[0]&&debugProducts[e].function_boost?"</b>^"+parseFloat(debugProducts[e].function_boost).toFixed(2):"")+': <br><progress value="'+t[o].toFixed(2)+'" max="100" style="width: 85px;"></progress></b>&nbsp;&nbsp;'+t[o].toFixed(2)+"%</div>"));if($(".debug-overlay",this).append('<div style="margin-top: 3px;"><b>popularity: </b>'+parseFloat(debugProducts[e].popularity).toFixed(2)+"</div>"),debugProducts[e].category_clicks&&$(".debug-overlay",this).append('<div style="margin-top: 3px;"><b>category clicks: </b>'+debugProducts[e].category_clicks+"</div>"),debugProducts[e].product_clicks&&$(".debug-overlay",this).append('<div style="margin-top: 3px;"><b>product clicks: </b>'+debugProducts[e].product_clicks+"</div>"),$(".debug-overlay",this).append('<div style="font-size: 12px; margin-top: 3px;"><b>score: '+parseFloat(debugProducts[e].score).toFixed(2)+"</b></div>"),debugProducts[e].boost_function){var a=$('<div style="margin-top: 5px; border-top: 1px solid #cccccc;"/>');for(var r in debugProducts[e].boost_function)a.append('<div style="font-size: 11px; line-height: 18px;"><i>'+debugProducts[e].boost_function[r].name+"("+debugProducts[e].boost_function[r].key+")</i>^"+debugProducts[e].boost_function[r].boost+"</div>");$(".debug-overlay",this).append(a)}$(".debug-overlay",this).append("</div>")}})}},Emag.Utils={_cookies:{},_config:{isOurOwnIp:!1},debug:!1,init:function(){this._processCookies()},setup:function(){var e=this;this._configAjaxIsAllowed()&&$.when(this._loadConfig()).done(function(t){$.extend(!0,e._config,t),e._config.isOurOwnIp===!0&&$(".bug-report-button").show()}).fail(function(e,t,i){})},_configAjaxIsAllowed:function(){return"1"===debug_buttons_allowed?!0:!1},_processCookies:function(){var e="Emag.Utils._cookies";try{this._cookies=null!=$.parseJSON($.cookie(e))?$.parseJSON($.cookie(e)):{}}catch(t){}"undefined"!=$.type(this._cookies.debug)&&(this.debug="true"==this._cookies.debug),this.debug===!0&&console.debug("Emag.Utils._processCookies")},_loadConfig:function(){this.debug===!0&&console.debug("Emag.Utils._loadConfig");var e=$.Deferred();try{$.ajax({url:"/search-tools/utils/config.json?v="+assets_version,type:"GET",dataType:"json",cache:!0}).done(function(t){var i="undefined"!==$.type(t)?t:{};e.resolve(i)}).fail(function(t,i,s){throw e.reject(),Emag.Utils.Exceptions.AjaxException(s)})}catch(t){console.error(t.message)}return e.promise()}},Emag.Utils.Exceptions={AjaxException:function(e){return this.name="Script Error",this.level="Show Stopper",this.message="undefined"!=$.type(e)?e:"An error occured while loading file.",this.htmlMessage="undefined"!=$.type(e)?e:"An error occured while loading file.",this.toString=function(){return this.name+": "+this.message},this}};